# <font face="微软雅黑" size="5">如何阅读代码——心得</font>  
<font face="微软雅黑" color="green" size="4">Recorded by xiaohongchao</font>

>所谓天才，不过是掌握了诀窍而已。
  
## 读代码的原因
>按阅读的目的分类
 
* 学习  
  + 将代码作为文档
  + 将代码作为范例

* 工作
  + 维护
  	 - 修复bug
  	 - 演进
	  	 - 增加新功能
	  	 - 修改现有功能或特性
	  	 - 重构——优化代码
  + 重用
  + 审查 


## 读代码的策略  

按阅读目的及代码规模

>读代码实际是一项自底向上的活动
>但对于大规模代码，需要先自顶而下，下到一定层次

* 学习目的
  + 作为文档  
	>学习目的：分析设计良好的软件系统，提升编码水准  
	策略：先读后改进  
     1. 先选择阅读目标（譬如讲算法的书就有很多版本，得挑一个合适自己的版本）
     2. 再确定阅读范围（学习目标：架构模式、编码方法、风格、算法、解决方案）
     3. 考虑运行环境和特殊的非功能性需求，预期代码特征
     4. 准备问题，阅读代码，找到答案
     5. 运行，再修改运行，验证理解是否正确
     6. 考虑如何改进它

  + 作为范例  
	>学习目的：解答“别人会怎样实现这个功能？”，了解某一特定功能如何实现的    
	策略：使用大量不同的策略与方法来了解代码的工作方式  
     1. 有文档优先阅读文档（优先设计文档，再用户文档）
     2. 快速定位到目标代码（不同的目的使用不同的搜索策略）
	     - 目标代码类型：
		     - 算法或数据结构
		     - 架构
		     - 第三方系统使用
	     - 搜索策略
		     - 文字搜索
		     - 设置断点，跟踪代码
		     - 使用工具
     3. 研究分析目标代码，忽略不相关的其他部分
	     - 切片方法（修改代码，删除不相关的部分，然后运行调试）

* 工作目的  
	> 整体策略：最小化代码阅读  
  + 维护
	  + 修复bug  
		>策略：不断缩小范围，直到发现问题（阅读代码作为补充手段）  
	     1. 优先使用工具
		     - 调试器，gdb等
		     - 日志分析
		     - 输入输出分析，postman+wireshark等
		     - 编译器
		     - 调用跟踪器，strace、ltrace等
		     - 包转储工具，core文件
		     - windows的消息侦查程序，spy++等
	     2. 修改代码作为补充
		     - 额外增加输出内容
		     - 插入只有特定情况下才运行的代码
		     - 二分法修改代码，通过预期缩小范围
		     - 回溯历史，进行版本回退验证，再逐步增加功能
		 3. 阅读代码作为补充
  	
	  + 演进
		>策略：先圈定范围，定位到代码，再推断节选出的代码与其余代码的关系
	     - 增加新功能
		     1. 找到类似特性的代码
		     2. 阅读，将其作为待实现功能的模板
	     - 修改现存的特性
		     1. 先定位到代码的实现
		     2. 研究它的实现
		     3. 设计修改内容
		     4. 定位影响到的区域
	     - 移植代码
		     1. 直接在新环境编译整个系统，按编译器提示错误进行修改
		     2. 验证系统的各项功能（集中验证系统对外的接口）
			     - 操作系统接口，工具：strace
			     - 网络接口，工具：wireshark
			     - 用户界面接口，工具：spy++
	     - 重构
		     - 增强非功能性品质
			     1. 确定重构目标
				     - 性能
				     - 灵活性
				     - 简单性
				     - 易理解性
			     1. 准备一套恰当的测试用例
			     1. 迭代进行：重构代码+验证
		     - 修复已知问题点
			     1. 理解老代码
			     1. 设计新实现
			     1. 分析影响
			     1. 重构代码
		     - 检视改进，主动寻找可以改进的地方
			     1. 了解系统整体的设计与框架
			     2. 阅读代码寻找重构机会
			     3. 重构代码

* 对于大规模代码
	>需要先自顶而下...  
	1. 了解项目的组织
	2. 了解项目的编码规范和约定
	3. 阅读文档
	4. 了解系统架构
		+ 面向对象
		+ 数据流
		+ 分布式
		+ 分层
			- 按系统中的控制流程和数据流
			- 按源代码的组织
	5. 了解子系统之间如何交互
	6. 系统的控制流程
		+ 消息驱动
		+ 数据驱动
		+ 事件驱动
		+ 状态机（状态变迁)
		+ 单独系统组件（调度/引擎模块）
	7. 限定到合适的阅读范围
		+ 模板
		+ 库
		+ 组件
		+ 类
	8. 其他见上（改为自底向上）


## 读代码的具体步骤和方法  